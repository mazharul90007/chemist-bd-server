generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String     @id @default(uuid())
  name      String?
  email     String     @unique
  password  String
  role      UserRole   @default(CUSTOMER)
  status    UserStatus @default(ACTIVE)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  medicines Medicine[]
  reviews   Review[]
  orders    Order[]

  @@map("users")
}

model Medicine {
  id           String           @id @default(uuid())
  sellerId     String
  seller       User             @relation(fields: [sellerId], references: [id])
  generic_name String?
  strength     String?
  company      String
  quantity     Int
  price        Int
  Indications  String?
  Pharmacology String?
  type         MedicineType     @default(OTHER)
  category     MedicineCategory @default(OTHER)
  dosage       String?
  side_effects String?
  warnings     String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  reviews      Review[]
  orderItems   OrderItem[]

  @@index([category, company, price])
  @@map("medicines")
}

model Review {
  id         String       @id @default(uuid())
  userId     String
  user       User         @relation(fields: [userId], references: [id])
  medicineId String
  medicine   Medicine     @relation(fields: [medicineId], references: [id])
  status     ReviewStatus @default(ACTIVE)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@map("reviews")
}

model Order {
  id            String        @id @default(uuid())
  orderNo       String
  totalAmount   Int
  dueAmount     Int
  paymentStatus PaymentStatus @default(UNPAID)
  customerId    String
  customer      User          @relation(fields: [customerId], references: [id])
  status        OrderStatus   @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  orderItems    OrderItem[]

  @@map("orders")
}

model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  order      Order    @relation(fields: [orderId], references: [id])
  medicineId String
  medicine   Medicine @relation(fields: [medicineId], references: [id])
  quantity   Int
  unitPrice  Int

  @@map("order_items")
}

enum UserRole {
  CUSTOMER
  SELLER
  ADMIN
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum MedicineType {
  SYRUP
  TABLET
  CAPSULE
  OTHER
}

enum MedicineCategory {
  ALLOPATHIC
  HERBAL
  OTHER
}

enum ReviewStatus {
  ACTIVE
  REJECTED
}

enum PaymentStatus {
  PAID
  UNPAID
  PARTIAL_PAID
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PACKAGING
  ON_THE_WAY
  DELIVERED
  CANCELED
}
